<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choropleth Map of US Drought Data</title>
    <link rel="stylesheet" href="https://unpkg.com/mapbox-gl/dist/mapbox-gl.css" />
    <style>
        #map { height: 600px; }
    </style>
    <script src="https://unpkg.com/mapbox-gl/dist/mapbox-gl.js"></script>
</head>
<body>
    <h1>US Current Drought Map</h1>
    <div id="map"></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiY2FsbGFoYWkiLCJhIjoiY204Z2Y2b3dwMDFxejJrb2NncTRqNWo4eSJ9.SWOSp9Q1_IHaFeoOtafDhQ';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'https://raw.githubusercontent.com/aidcallahan/lab4/main/style.json',
            center: [-96, 37.8],
            zoom: 4
        });
        map.on('load', function() {
            fetch('https://raw.githubusercontent.com/aidcallahan/lab3/main/usdm_current.json')
                .then(response => {
                    if (!response.ok) {
                        console.error("Failed to fetch GeoJSON data. Status: " + response.status);
                        return Promise.reject("GeoJSON fetch failed");
                    } else {
                        return response.json();
                    }
                })
                .then(data => {
                    if (data) {
                        map.addSource('drought-data', {
                            type: 'geojson',
                            data: data
                        });

                        map.addLayer({
                            id: 'drought-layer',
                            type: 'fill',
                            source: 'drought-data',
                            paint: {
                                'fill-color': [
                                    'match',
                                    ['get', 'DM'],
                                    0, '#31a354',
                                    1, '#78c679',
                                    2, '#addd8e',
                                    3, '#fdae61',
                                    4, '#f16913',
                                    '#d7301f'
                                ],
                                'fill-opacity': 0.7
                            }
                        });
                        map.on('mouseenter', 'drought-layer', function() {
                            map.getCanvas().style.cursor = 'pointer';
                        });

                        map.on('mouseleave', 'drought-layer', function() {
                            map.getCanvas().style.cursor = '';
                        });

                        map.on('click', 'drought-layer', function(e) {
                            var properties = e.features[0].properties;
                            var popupContent = `
                                <strong>${properties.name || 'Unknown Area'}</strong><br>
                                Drought Intensity (DM): ${properties.DM || 'Unknown'}<br>
                                Drought Severity: ${getDroughtLevel(properties.DM)}
                            `;
                            new mapboxgl.Popup()
                                .setLngLat(e.lngLat)
                                .setHTML(popupContent)
                                .addTo(map);
                        });
                    } else {
                        console.error("No data available to load.");
                    }
                })
                .catch(error => {
                    console.error("Error loading GeoJSON data:", error);
                });
        });
        function getDroughtLevel(droughtIntensity) {
            switch (droughtIntensity) {
                case 0: return "No Drought";
                case 1: return "Abnormally Dry";
                case 2: return "Moderate Drought";
                case 3: return "Severe Drought";
                case 4: return "Extreme Drought";
                case 5: return "Exceptional Drought";
                default: return "Unknown";
            }
        }
    </script>
</body>
</html>
